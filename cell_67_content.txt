# ============================================================
# 3-4. ì‹œë‚˜ë¦¬ì˜¤ë³„ í”¼ì²˜ ë¦¬ìŠ¤íŠ¸ í™•ì •
# ============================================================

# ìœ ì§€ íŒŒìƒë³€ìˆ˜ ë¦¬ìŠ¤íŠ¸
remaining_all = FEATURES + remaining_derived

# ì‹œë‚˜ë¦¬ì˜¤ ì •ì˜
scenario1_features = ['initial_voltage', 'initial_impedance', 'ocv_deviation']

scenario2_features = ['initial_voltage', 'initial_impedance',
                      'v42_voltage', 'v42_impedance',
                      'impedance_ratio_42', 'voltage_delta_initial_42',
                      'impedance_voltage_product', 'health_index', 'ocv_deviation']

scenario3_features = scenario2_features + [
    'v36_voltage', 'v36_impedance', 'impedance_mean']

scenario4_features = remaining_all

scenarios = {
    'ì‹œë‚˜ë¦¬ì˜¤ 1 (INITIAL only)': scenario1_features,
    'ì‹œë‚˜ë¦¬ì˜¤ 2 (INITIAL + 4.2V)': scenario2_features,
    'ì‹œë‚˜ë¦¬ì˜¤ 3 (INITIAL + 4.2V + 3.6V)': scenario3_features,
    'ì‹œë‚˜ë¦¬ì˜¤ 4 (ì „ì²´)': scenario4_features,
}

print('ğŸ“‹ ì‹œë‚˜ë¦¬ì˜¤ë³„ í”¼ì²˜ êµ¬ì„±')
print('=' * 70)
for name, feats in scenarios.items():
    corrs = [(f, df_clean[f].corr(df_clean[TARGET])) for f in feats]
    corrs.sort(key=lambda x: abs(x[1]), reverse=True)
    max_r = max(abs(r) for _, r in corrs)
    print(f'\n{name} ({len(feats)}ê°œ í”¼ì²˜, ìµœëŒ€|r|={max_r:.3f}):')
    for f, r in corrs:
        strength = 'ğŸŸ¢' if abs(r) > 0.5 else ('ğŸŸ¡' if abs(r) > 0.2 else 'ğŸ”´')
        print(f'  {strength} {f:35s}: r={r:+.4f}')

print('\n' + '=' * 70)
print('âœ… Phase 3 ì™„ë£Œ â†’ Phase 4 (í•™ìŠµ ë°ì´í„° êµ¬ì„±)ë¡œ ì§„í–‰')
print('=' * 70)